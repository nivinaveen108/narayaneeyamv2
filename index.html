// Devanagari aspirated letters
const devanagariAspirated = '[खघछठढथधफभ]';

// Match aspirated letters even inside conjuncts
const devanagariMahapraanas = new RegExp(
  // optionally preceded by any consonants + halant
  '(?:[क-ह]\u094D)*' + devanagariAspirated,
  'g'
);

// English transliteration Mahāprāṇa
const englishMahapraanas = /\b(kh|gh|chh|jh|ṭh|ḍh|th|dh|ph|bh)\b/gi;

// Malayalam Mahāprāṇa letters
const malayalamMahapraanas = /[ഖഘഝഠഢധഫഭ]/g;

function highlightMahapraana(text, script = 'devanagari') {
  if (!text) return '';

  switch (script) {
    case 'devanagari':
      // Highlight aspirated letters even inside conjuncts
      return text.replace(devanagariMahapraanas, m => {
        // Only highlight the final aspirated consonant
        const lastChar = m[m.length - 1];
        return m.slice(0, -1) + `<span class="mahapraana">${lastChar}</span>`;
      });

    case 'english':
      return text.replace(englishMahapraanas, m => `<span class="mahapraana">${m}</span>`);

    case 'malayalam':
      return text.replace(malayalamMahapraanas, m => `<span class="mahapraana">${m}</span>`);

    default:
      return text;
  }
}
